{
  "$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
  "name": "NX",
  "scopeName": "source.nx",
  "fileTypes": ["nx"],
  "patterns": [
    { "include": "#comments" },
    { "include": "#value-definition" },
    { "include": "#module-root-element" },
    { "include": "#embed-raw-block" },
    { "include": "#elements-if" },
    { "include": "#elements-for" },
    { "include": "#value-if" },
    { "include": "#value-for" },
    { "include": "#tags" },
    { "include": "#strings" },
    { "include": "#numbers" },
    { "include": "#keywords-core" },
    { "include": "#types" },
    { "include": "#operators" },
    { "include": "#interpolation" },
    { "include": "#entities" }
  ],
  "repository": {
    "comments": {
      "patterns": [
        {
          "name": "comment.block.html.nx",
          "begin": "<!--",
          "end": "-->",
          "patterns": [ { "include": "#comments" } ]
        },
        {
          "name": "comment.block.nx",
          "begin": "/\\*",
          "end": "\\*/",
          "patterns": [ { "include": "#comments" } ]
        },
        {
          "name": "comment.line.double-slash.nx",
          "match": "//.*$"
        }
      ]
    },
    "entities": {
      "patterns": [
        {
          "name": "constant.character.entity.nx",
          "match": "&(?:lt|gt|amp|quot|apos|lbrace|rbrace|nbsp);|&(?# generic)(?:#\\d+|#x[0-9A-Fa-f]+|[A-Za-z][A-Za-z0-9]+);"
        }
      ]
    },
    "strings": {
      "patterns": [
        {
          "name": "string.quoted.double.nx",
          "begin": "\"",
          "end": "\"",
          "patterns": [
            { "include": "#entities" },
            { "include": "#interpolation" },
            { "name": "constant.character.escape.nx", "match": "\\\\[\\\\\"nrt]" }
          ]
        },
        {
          "name": "string.quoted.single.nx",
          "begin": "'",
          "end": "'",
          "patterns": [
            { "include": "#entities" },
            { "include": "#interpolation" },
            { "name": "constant.character.escape.nx", "match": "\\\\[\\\\'nrt]" }
          ]
        }
      ]
    },
    "numbers": {
      "patterns": [
        { "name": "constant.numeric.hex.nx", "match": "(?:0x|0X)[0-9A-Fa-f](?:_?[0-9A-Fa-f])*" },
        { "name": "constant.numeric.float.nx", "match": "(?:[0-9](?:_?[0-9])*)(?:\\.(?:[0-9](?:_?[0-9])*)?)(?:[eE][+-]?(?:[0-9](?:_?[0-9])*))?" },
        { "name": "constant.numeric.float.nx", "match": "(?:[0-9](?:_?[0-9])*)(?:[eE][+-]?(?:[0-9](?:_?[0-9])*))" },
        { "name": "constant.numeric.integer.nx", "match": "[0-9](?:_?[0-9])*" }
      ]
    },
    "keywords-core": {
      "patterns": [
        { "name": "keyword.control.import.nx", "match": "\\bimport\\b" },
        { "name": "keyword.declaration.type.nx", "match": "\\btype\\b" },
        { "name": "keyword.declaration.let.nx", "match": "\\blet\\b" },
        { "name": "keyword.other.raw.nx", "match": "\\braw\\b" },
        { "name": "constant.language.boolean.nx", "match": "\\b(?:true|false)\\b" },
        { "name": "constant.language.null.nx", "match": "\\bnull\\b" }
      ]
    },
    "keywords-control": {
      "patterns": [
        { "name": "keyword.control.conditional.nx", "match": "\\bif\\b|\\belse\\b" },
        { "name": "keyword.control.match.nx", "match": "\\bis\\b" },
        { "name": "keyword.control.loop.nx", "match": "\\bfor\\b|\\bin\\b" }
      ]
    },
    "types": {
      "patterns": [
        {
          "name": "storage.type.primitive.nx",
          "match": "\\b(?:string|int|long|float|double|boolean|void|object)\\b"
        },
        {
          "name": "keyword.operator.type-modifier.nx",
          "match": "\\[\\]"
        }
      ]
    },
    "operators": {
      "patterns": [
        { "name": "keyword.operator.arithmetic.nx", "match": "\\+|-|\\*|/" },
        { "name": "keyword.operator.comparison.nx", "match": "<=|>=|==|!=|<|>" },
        { "name": "keyword.operator.logical.nx", "match": "&&|\\|\\|" },
        { "name": "keyword.operator.conditional.nx", "match": "\\?" },
        { "name": "punctuation.separator.conditional.nx", "match": ":" },
        { "name": "punctuation.separator.dot.nx", "match": "\\." },
        { "name": "keyword.operator.assignment.nx", "match": "=" }
      ]
    },
    "value-definition": {
      "begin": "^(\\s*)(let)\\s+(?!<)([A-Za-z_][A-Za-z0-9_]*)",
      "beginCaptures": {
        "2": { "name": "keyword.declaration.let.nx" },
        "3": { "name": "entity.name.variable.nx" }
      },
      "end": "(?==)",
      "name": "meta.definition.value.nx",
      "patterns": [
        { "name": "punctuation.separator.type.annotation.nx", "match": ":" },
        { "include": "#types" },
        { "include": "#qualifiers" },
        { "include": "#operators" },
        { "include": "#keywords-core" },
        { "include": "#keywords-control" },
        { "include": "#numbers" },
        { "include": "#strings" },
        { "include": "#comments" }
      ]
    },
    "qualifiers": {
      "patterns": [
        {
          "name": "entity.name.qualifier.nx",
          "match": "[A-Za-z_][A-Za-z0-9_]*(?:\\.[A-Za-z_][A-Za-z0-9_-]*)*"
        }
      ]
    },
    "interpolation": {
      "begin": "(?<!\\\\)\\{",
      "beginCaptures": { "0": { "name": "punctuation.section.interpolation.begin.nx" } },
      "end": "\\}",
      "endCaptures": { "0": { "name": "punctuation.section.interpolation.end.nx" } },
      "name": "meta.interpolation.nx",
      "patterns": [
        { "include": "#value-if" },
        { "include": "#value-for" },
        { "include": "#comments" },
        { "include": "#strings" },
        { "include": "#numbers" },
        { "include": "#keywords-core" },
        { "include": "#keywords-control" },
        { "include": "#types" },
        { "include": "#operators" },
        { "include": "#qualifiers" }
      ]
    },
    "attr-value": {
      "patterns": [
        { "include": "#strings" },
        { "include": "#interpolation" },
        { "include": "#tags" },
        { "include": "#numbers" },
        { "include": "#keywords-core" },
        { "include": "#keywords-control" }
      ]
    },
    "attr-name": {
      "name": "entity.other.attribute-name.nx",
      "match": "[A-Za-z_][A-Za-z0-9_]*(?:\\.[A-Za-z_][A-Za-z0-9_-]*)*"
    },
    "module-root-element": {
      "begin": "^(?=<[A-Za-z_])",
      "end": "(?=\\s*$)",
      "name": "meta.module.root-element.nx",
      "patterns": [
        { "include": "#tags" },
        { "include": "#interpolation" },
        { "include": "#strings" },
        { "include": "#entities" },
        { "include": "#comments" }
      ]
    },
    "tags": {
      "patterns": [
        { "include": "#embed-raw-block" },
        { "include": "#fragment" },
        { "include": "#end-tag" },
        { "include": "#start-tag" }
      ]
    },
    "embed-raw-block": {
      "begin": "<([A-Za-z_][A-Za-z0-9_]*(?:\\.[A-Za-z_][A-Za-z0-9_-]*)*)\\s*:[A-Za-z_][A-Za-z0-9_-]*\\s+raw\b[^>]*>",
      "beginCaptures": {
        "0": { "name": "meta.tag.start.nx" }
      },
      "end": "</\\1>",
      "endCaptures": {
        "0": { "name": "meta.tag.end.nx" }
      },
      "name": "meta.embed.raw.nx",
      "patterns": [
        { "name": "meta.embed.raw.content.nx", "match": "[^<]+" },
        { "include": "#comments" }
      ]
    },
    "fragment": {
      "begin": "<>",
      "beginCaptures": {
        "0": { "name": "punctuation.definition.tag.begin.nx" }
      },
      "end": "</>",
      "endCaptures": {
        "0": { "name": "punctuation.definition.tag.end.nx" }
      },
      "name": "meta.tag.fragment.nx",
      "patterns": [
        { "include": "#elements-if" },
        { "include": "#elements-for" },
        { "include": "#tags" },
        { "include": "#interpolation" },
        { "include": "#strings" },
        { "include": "#entities" }
      ]
    },
    "end-tag": {
      "begin": "</",
      "beginCaptures": {
        "0": { "name": "punctuation.definition.tag.begin.nx" }
      },
      "end": ">",
      "endCaptures": {
        "0": { "name": "punctuation.definition.tag.end.nx" }
      },
      "name": "meta.tag.end.nx",
      "patterns": [
        {
          "name": "entity.name.tag.nx",
          "match": "[A-Za-z_][A-Za-z0-9_]*(?:\\.[A-Za-z_][A-Za-z0-9_-]*)*"
        }
      ]
    },
    "start-tag": {
      "begin": "<(?!/)",
      "beginCaptures": {
        "0": { "name": "punctuation.definition.tag.begin.nx" }
      },
      "end": ">",
      "endCaptures": {
        "0": { "name": "punctuation.definition.tag.end.nx" }
      },
      "name": "meta.tag.start.nx",
      "patterns": [
        {
          "name": "entity.name.tag.nx",
          "match": "\\G[A-Za-z_][A-Za-z0-9_]*(?:\\.[A-Za-z_][A-Za-z0-9_-]*)*"
        },
        {
          "name": "support.type.text.nx",
          "match": ":[A-Za-z_][A-Za-z0-9_-]*"
        },
        {
          "name": "keyword.other.raw.nx",
          "match": "\\braw\\b"
        },
        { "include": "#attributes" },
        {
          "name": "punctuation.definition.tag.self-closing.nx",
          "match": "/(?=\\s*>)"
        }
      ]
    },
    "attributes": {
      "patterns": [
        { "include": "#property-list-if" },
        {
          "name": "meta.attribute.nx",
          "match": "\\.\\.\\.[A-Za-z_][A-Za-z0-9_]*(?:\\.[A-Za-z_][A-Za-z0-9_-]*)*"
        },
        { "include": "#keywords-core" },
        {
          "begin": "(?=[A-Za-z_][A-Za-z0-9_]*(?:\\.[A-Za-z_][A-Za-z0-9_-]*)*\\s*=)",
          "end": "(?=\n|[/>])",
          "patterns": [
            { "include": "#keywords-control" },
            { "include": "#attr-name" },
            { "name": "keyword.operator.assignment.nx", "match": "=" },
            { "include": "#attr-value" }
          ]
        }
      ]
    },

    "elements-if": {
      "begin": "(?:(?<=^|\\n|\\}|>)[ \\t]*|(?<=\\belse\\s+))(if)\\b",
      "beginCaptures": { "1": { "name": "keyword.control.conditional.nx" } },
      "end": "(?<=\\})(?!\\s*else\\b)",
      "name": "meta.control.if.elements.nx",
      "patterns": [
        { "include": "#comments" },
        { "include": "#strings" },
        { "include": "#numbers" },
        { "include": "#elements-if" },
        { "include": "#elements-for" },
        { "include": "#tags" },
        { "include": "#value-if" },
        { "include": "#value-for" },
        {
          "begin": "\\{",
          "beginCaptures": { "0": { "name": "punctuation.section.block.begin.nx" } },
          "end": "\\}",
          "endCaptures": { "0": { "name": "punctuation.section.block.end.nx" } },
          "patterns": [
            { "include": "#comments" },
            { "include": "#strings" },
            { "include": "#numbers" },
            { "include": "#elements-if" },
            { "include": "#elements-for" },
            { "include": "#tags" },
            { "include": "#value-if" },
            { "include": "#value-for" },
            { "include": "#interpolation" },
            { "include": "#keywords-control" },
            { "include": "#types" },
            { "include": "#operators" }
          ]
        },
        { "include": "#interpolation" },
        { "include": "#keywords-control" },
        { "include": "#types" },
        { "include": "#operators" }
      ]
    },
    "value-if": {
      "begin": "(?<![A-Za-z0-9_])(if)\\b",
      "beginCaptures": { "1": { "name": "keyword.control.conditional.nx" } },
      "end": "(?<=\\})(?!\\s*else\\b)",
      "name": "meta.control.if.value.nx",
      "patterns": [
        { "include": "#comments" },
        { "include": "#strings" },
        { "include": "#numbers" },
        { "include": "#value-if" },
        { "include": "#value-for" },
        { "include": "#elements-if" },
        { "include": "#elements-for" },
        { "include": "#tags" },
        {
          "begin": "\\{",
          "beginCaptures": { "0": { "name": "punctuation.section.block.begin.nx" } },
          "end": "\\}",
          "endCaptures": { "0": { "name": "punctuation.section.block.end.nx" } },
          "patterns": [
            { "include": "#comments" },
            { "include": "#strings" },
            { "include": "#numbers" },
            { "include": "#value-if" },
            { "include": "#value-for" },
            { "include": "#elements-if" },
            { "include": "#elements-for" },
            { "include": "#tags" },
            { "include": "#interpolation" },
            { "include": "#keywords-control" },
            { "include": "#types" },
            { "include": "#operators" }
          ]
        },
        { "include": "#interpolation" },
        { "include": "#keywords-control" },
        { "include": "#types" },
        { "include": "#operators" }
      ]
    },
    "elements-for": {
      "begin": "(?<=^|\\n|\\}|>)[ \\t]*(for)\\b",
      "beginCaptures": { "1": { "name": "keyword.control.loop.nx" } },
      "end": "\\}",
      "endCaptures": { "0": { "name": "punctuation.section.block.end.nx" } },
      "name": "meta.control.loop.elements.nx",
      "patterns": [
        { "include": "#comments" },
        { "include": "#strings" },
        { "include": "#numbers" },
        { "include": "#elements-if" },
        { "include": "#elements-for" },
        { "include": "#tags" },
        {
          "begin": "\\{",
          "beginCaptures": { "0": { "name": "punctuation.section.block.begin.nx" } },
          "end": "(?=\\})",
          "patterns": [
            { "include": "#comments" },
            { "include": "#strings" },
            { "include": "#numbers" },
            { "include": "#elements-if" },
            { "include": "#elements-for" },
            { "include": "#tags" },
            { "include": "#interpolation" },
            { "include": "#types" },
            { "include": "#operators" }
          ]
        },
        { "include": "#interpolation" },
        { "include": "#types" },
        { "include": "#operators" },
        { "name": "keyword.control.loop.nx", "match": "\\bin\\b" }
      ]
    },
    "value-for": {
      "begin": "(?<![A-Za-z0-9_])(for)\\b",
      "beginCaptures": { "1": { "name": "keyword.control.loop.nx" } },
      "end": "\\}",
      "endCaptures": { "0": { "name": "punctuation.section.block.end.nx" } },
      "name": "meta.control.loop.value.nx",
      "patterns": [
        { "include": "#comments" },
        { "include": "#strings" },
        { "include": "#numbers" },
        { "include": "#value-if" },
        { "include": "#value-for" },
        { "include": "#elements-if" },
        { "include": "#elements-for" },
        { "include": "#tags" },
        {
          "begin": "\\{",
          "beginCaptures": { "0": { "name": "punctuation.section.block.begin.nx" } },
          "end": "(?=\\})",
          "patterns": [
            { "include": "#comments" },
            { "include": "#strings" },
            { "include": "#numbers" },
            { "include": "#value-if" },
            { "include": "#value-for" },
            { "include": "#elements-if" },
            { "include": "#elements-for" },
            { "include": "#tags" },
            { "include": "#interpolation" },
            { "include": "#types" },
            { "include": "#operators" }
          ]
        },
        { "include": "#interpolation" },
        { "include": "#types" },
        { "include": "#operators" },
        { "name": "keyword.control.loop.nx", "match": "\\bin\\b" }
      ]
    },

    "property-list-if": {
      "begin": "(?<![A-Za-z0-9_])(if)\\b",
      "beginCaptures": { "1": { "name": "keyword.control.conditional.nx" } },
      "end": "(?<=\\})(?!\\s*else\\b)",
      "name": "meta.control.if.properties.nx",
      "patterns": [
        { "include": "#comments" },
        { "include": "#strings" },
        { "include": "#numbers" },
        { "include": "#value-if" },
        { "include": "#value-for" },
        { "include": "#elements-if" },
        { "include": "#elements-for" },
        { "include": "#tags" },
        {
          "begin": "\\{",
          "beginCaptures": { "0": { "name": "punctuation.section.block.begin.nx" } },
          "end": "\\}",
          "endCaptures": { "0": { "name": "punctuation.section.block.end.nx" } },
          "patterns": [
            { "include": "#comments" },
            { "include": "#strings" },
            { "include": "#numbers" },
            { "include": "#value-if" },
            { "include": "#value-for" },
            { "include": "#elements-if" },
            { "include": "#elements-for" },
            { "include": "#tags" },
            { "include": "#attributes" },
            { "include": "#interpolation" },
            { "include": "#keywords-control" },
            { "include": "#types" },
            { "include": "#operators" }
          ]
        },
        { "include": "#interpolation" },
        { "include": "#keywords-control" },
        { "include": "#types" },
        { "include": "#operators" }
      ]
    }
  }
}
